"0","library(googlesheets4)"
"0","library(dplyr)"
"0","library(tidyr)"
"0","library(lubridate)"
"0","library(ggplot2)"
"0","library(stringr)"
"0",""
"0","# 1️⃣ Load data"
"0","dat <- read_sheet(""https://docs.google.com/spreadsheets/d/1KcAYb0czCxgbFpE-7DaJSv4EGLgqm6xgdZbpPmvlkNc/edit?usp=sharing"")"
"0",""
"0","# 2️⃣ Parse Date safely"
"0","dat <- dat %>%"
"0","  mutate(Date = parse_date_time(Date, orders = c(""mdy"", ""dmy"", ""ymd""))) %>%"
"0","  filter(!is.na(Date))"
"0",""
"0","# 3️⃣ Separate Sample"
"0","morph <- dat %>%"
"0","  separate(Sample, into = c(""Bact"", ""Temp"", ""Salinity""), sep = ""_"", remove = FALSE) %>%"
"0","  mutate("
"0","    Rep  = str_sub(Bact, start = -1),"
"0","    Bact = str_sub(Bact, end = -2)"
"0","  )"
"0",""
"0","# 4️⃣ Pivot longer and calculate relative abundance"
"0","rel_abund_by_rep <- morph %>%"
"0","  pivot_longer("
"0","    cols = -c(Bact, Temp, Rep, Salinity, Date, Sample),  # pivot only numeric columns"
"0","    names_to = ""category"","
"0","    values_to = ""val"""
"0","  ) %>%"
"0","  filter(category != ""total_images"") %>%"
"0","  group_by(Bact, Temp, Rep, Salinity, Date) %>%"
"0","  mutate("
"0","    sumcount = sum(val, na.rm = TRUE),"
"0","    percent  = val / sumcount"
"0","  ) %>%"
"0","  ungroup()"
"0",""
"0","# 5️⃣ Check for presence of ""Cyst"" category"
"0","if(""cyst"" %in% rel_abund_by_rep$category){"
"0","  "
"0","  # Filter for Cyst and remove NAs"
"0","  cyst_data <- rel_abund_by_rep %>%"
"0","    filter(category == ""cyst"") %>%"
"0","    filter(!is.na(percent))"
"0","  "
"0","  if(nrow(cyst_data) > 0){"
"0","    # Plot"
"0","    ggplot(cyst_data, aes(x = Date, y = percent, color = Bact)) +"
"0","      geom_point() +"
"0","      facet_grid(Salinity ~ Temp) +"
"0","      theme_bw() +"
"0","      theme("
"0","        panel.grid.major.x = element_blank(),"
"0","        panel.grid.minor.y = element_blank()"
"0","      ) +"
"0","      ggtitle(""Relative Abundance of Cysts by Replicate"") +"
"0","      ylab(""Percent of total counts"")"
"0","  } else {"
"0","    message(""No rows with valid 'Cyst' data to plot."")"
"0","  }"
"0","  "
"0","} else {"
"0","  message(""No 'Cyst' category present in the dataset!"")"
"0","}"
