group_by(Bact, Temp, Rep, Salinity, Date) %>%
mutate(
sumcount = sum(val, na.rm = TRUE),
percent  = val / sumcount
) %>%
ungroup()
# 5️⃣ Check for presence of "Cyst" category
if("cyst" %in% rel_abund_by_rep$category){
# Filter for Cyst and remove NAs
cyst_data <- rel_abund_by_rep %>%
filter(category == "cyst") %>%
filter(!is.na(percent))
if(nrow(cyst_data) > 0){
# Plot
ggplot(cyst_data, aes(x = Date, y = percent, color = Bact)) +
geom_point() +
facet_grid(Salinity ~ Temp) +
theme_bw() +
theme(
panel.grid.major.x = element_blank(),
panel.grid.minor.y = element_blank()
) +
ggtitle("Relative Abundance of Cysts by Replicate") +
ylab("Percent of total counts")
} else {
message("No rows with valid 'Cyst' data to plot.")
}
} else {
message("No 'Cyst' category present in the dataset!")
}
library(googlesheets4)
library(dplyr)
library(tidyr)
library(lubridate)
library(ggplot2)
library(stringr)
# 1️⃣ Load data
dat <- read_sheet("https://docs.google.com/spreadsheets/d/1KcAYb0czCxgbFpE-7DaJSv4EGLgqm6xgdZbpPmvlkNc/edit?usp=sharing")
# 2️⃣ Parse Date safely
dat <- dat %>%
mutate(Date = parse_date_time(Date, orders = c("mdy", "dmy", "ymd"))) %>%
filter(!is.na(Date))
# 3️⃣ Parse Sample into Bact, Temp, Salinity, and Rep
morph <- dat %>%
separate(Sample, into = c("Bact", "Temp", "Salinity", "Extra", "Rep"), sep = "_", remove = FALSE, fill = "right") %>%
mutate(
Rep = ifelse(is.na(Rep), Extra, Rep),  # If 4 parts (like OTB_H_30_1), Rep is in "Extra"
Rep = as.character(Rep)
) %>%
select(-Extra)  # Drop if you don't need the extra column
# 4️⃣ Pivot longer and calculate relative abundance
rel_abund_by_rep <- morph %>%
pivot_longer(
cols = -c(Bact, Temp, Rep, Salinity, Date, Sample),  # pivot only numeric columns
names_to = "category",
values_to = "val"
) %>%
filter(category != "total_images") %>%
group_by(Bact, Temp, Rep, Salinity, Date) %>%
mutate(
sumcount = sum(val, na.rm = TRUE),
percent  = val / sumcount
) %>%
ungroup()
# 5️⃣ Check for presence of "Cyst" category
if("cyst" %in% rel_abund_by_rep$category){
# Filter for Cyst and remove NAs
cyst_data <- rel_abund_by_rep %>%
filter(category == "cyst") %>%
filter(!is.na(percent))
if(nrow(cyst_data) > 0){
# Plot
ggplot(cyst_data, aes(x = Date, y = percent, color = Bact)) +
geom_point() +
facet_grid(Salinity ~ Temp) +
scale_color_manual(values = c("LD" = "gold", "OTB" = "purple")) +
theme_bw() +
theme(
panel.grid.major.x = element_blank(),
panel.grid.minor.y = element_blank()
) +
ggtitle("Relative Abundance of Cysts by Replicate") +
ylab("Percent of total counts")
library(googlesheets4)
library(dplyr)
library(tidyr)
library(lubridate)
library(ggplot2)
library(stringr)
# 1️⃣ Load data
dat <- read_sheet("https://docs.google.com/spreadsheets/d/1KcAYb0czCxgbFpE-7DaJSv4EGLgqm6xgdZbpPmvlkNc/edit?usp=sharing")
# 2️⃣ Parse Date safely
dat <- dat %>%
mutate(Date = parse_date_time(Date, orders = c("mdy", "dmy", "ymd"))) %>%
filter(!is.na(Date))
# 3️⃣ Parse Sample into Bact, Temp, Salinity, and Rep
morph <- dat %>%
separate(Sample, into = c("Bact", "Temp", "Salinity", "Extra", "Rep"), sep = "_", remove = FALSE, fill = "right") %>%
mutate(
Rep = ifelse(is.na(Rep), Extra, Rep),  # If 4 parts (like OTB_H_30_1), Rep is in "Extra"
Rep = as.character(Rep)
) %>%
select(-Extra)  # Drop if you don't need the extra column
# 4️⃣ Pivot longer and calculate relative abundance
rel_abund_by_rep <- morph %>%
pivot_longer(
cols = -c(Bact, Temp, Rep, Salinity, Date, Sample),  # pivot only numeric columns
names_to = "category",
values_to = "val"
) %>%
filter(category != "total_images") %>%
group_by(Bact, Temp, Rep, Salinity, Date) %>%
mutate(
sumcount = sum(val, na.rm = TRUE),
percent  = val / sumcount
) %>%
ungroup()
# 5️⃣ Check for presence of "Cyst" category
if("cyst" %in% rel_abund_by_rep$category){
# Filter for Cyst and remove NAs
cyst_data <- rel_abund_by_rep %>%
filter(category == "cyst") %>%
filter(!is.na(percent))
if(nrow(cyst_data) > 0){
# Plot
ggplot(cyst_data, aes(x = Date, y = percent, color = Bact)) +
geom_point() +
facet_grid(Salinity ~ Temp) +
theme_bw() +
theme(
panel.grid.major.x = element_blank(),
panel.grid.minor.y = element_blank()
) +
scale_color_manual(
values = c("LD" = "gold", "OTB" = "purple")
) +
ggtitle("Relative Abundance of Cysts by Replicate") +
ylab("Percent of total counts")
} else {
message("No rows with valid 'Cyst' data to plot.")
}
} else {
message("No 'Cyst' category present in the dataset!")
}
library(googlesheets4)
library(dplyr)
library(tidyr)
library(lubridate)
library(ggplot2)
library(stringr)
# 1️⃣ Load data
dat <- read_sheet("https://docs.google.com/spreadsheets/d/1KcAYb0czCxgbFpE-7DaJSv4EGLgqm6xgdZbpPmvlkNc/edit?usp=sharing")
# 2️⃣ Parse Date safely
dat <- dat %>%
mutate(Date = parse_date_time(Date, orders = c("mdy", "dmy", "ymd"))) %>%
filter(!is.na(Date))
# 3️⃣ Parse Sample into Bact, Temp, Salinity, and Rep
morph <- dat %>%
separate(Sample, into = c("Bact", "Temp", "Salinity", "Extra", "Rep"), sep = "_", remove = FALSE, fill = "right") %>%
mutate(
Rep = ifelse(is.na(Rep), Extra, Rep),  # If 4 parts (like OTB_H_30_1), Rep is in "Extra"
Rep = as.character(Rep)
) %>%
select(-Extra)  # Drop if you don't need the extra column
# 4️⃣ Pivot longer and calculate relative abundance
rel_abund_by_rep <- morph %>%
pivot_longer(
cols = -c(Bact, Temp, Rep, Salinity, Date, Sample),  # pivot only numeric columns
names_to = "category",
values_to = "val"
) %>%
filter(category != "total_images") %>%
group_by(Bact, Temp, Rep, Salinity, Date) %>%
mutate(
sumcount = sum(val, na.rm = TRUE),
percent  = val / sumcount
) %>%
ungroup()
# 5️⃣ Check for presence of "Cyst" category
if("cyst" %in% rel_abund_by_rep$category){
# Filter for Cyst and remove NAs
cyst_data <- rel_abund_by_rep %>%
filter(category == "cyst") %>%
filter(!is.na(percent))
if(nrow(cyst_data) > 0){
# Plot
ggplot(cyst_data, aes(x = Date, y = percent, color = Bact)) +
geom_point() +
facet_grid(Salinity ~ Temp) +
theme_bw() +
theme(
panel.grid.major.x = element_blank(),
panel.grid.minor.y = element_blank()
) +
scale_color_manual(
values = c("LD" = "green", "OTB" = "blue")
) +
ggtitle("Relative Abundance of Cysts by Replicate") +
ylab("Percent of total counts")
} else {
message("No rows with valid 'Cyst' data to plot.")
}
} else {
message("No 'Cyst' category present in the dataset!")
}
library(googlesheets4)
library(dplyr)
library(tidyr)
library(lubridate)
library(ggplot2)
library(stringr)
# 1️⃣ Load data
dat <- read_sheet("https://docs.google.com/spreadsheets/d/1KcAYb0czCxgbFpE-7DaJSv4EGLgqm6xgdZbpPmvlkNc/edit?usp=sharing")
# 2️⃣ Parse Date safely
dat <- dat %>%
mutate(Date = parse_date_time(Date, orders = c("mdy", "dmy", "ymd"))) %>%
filter(!is.na(Date))
# 3️⃣ Parse Sample into Bact, Temp, Salinity, and Rep
morph <- dat %>%
separate(Sample, into = c("Bact", "Temp", "Salinity", "Extra", "Rep"), sep = "_", remove = FALSE, fill = "right") %>%
mutate(
Rep = ifelse(is.na(Rep), Extra, Rep),  # If 4 parts (like OTB_H_30_1), Rep is in "Extra"
Rep = as.character(Rep)
) %>%
select(-Extra)  # Drop if you don't need the extra column
# 4️⃣ Pivot longer and calculate relative abundance
rel_abund_by_rep <- morph %>%
pivot_longer(
cols = -c(Bact, Temp, Rep, Salinity, Date, Sample),  # pivot only numeric columns
names_to = "category",
values_to = "val"
) %>%
filter(category != "total_images") %>%
group_by(Bact, Temp, Rep, Salinity, Date) %>%
mutate(
sumcount = sum(val, na.rm = TRUE),
percent  = val / sumcount
) %>%
ungroup()
# 5️⃣ Check for presence of "Cyst" category
if("cyst" %in% rel_abund_by_rep$category){
# Filter for Cyst and remove NAs
cyst_data <- rel_abund_by_rep %>%
filter(category == "cyst") %>%
filter(!is.na(percent))
if(nrow(cyst_data) > 0){
# Plot
ggplot(cyst_data, aes(x = Date, y = percent, color = Bact)) +
geom_point() +
facet_grid(Salinity ~ Temp) +
theme_bw() +
theme(
panel.grid.major.x = element_blank(),
panel.grid.minor.y = element_blank()
) +
scale_color_manual(
values = c("LD" = "#008080", "OTB" = "#CD7F32")
) +
ggtitle("Relative Abundance of Cysts by Replicate") +
ylab("Percent of total counts")
} else {
message("No rows with valid 'Cyst' data to plot.")
}
} else {
message("No 'Cyst' category present in the dataset!")
}
library(googlesheets4)
library(dplyr)
library(tidyr)
library(lubridate)
library(ggplot2)
library(stringr)
# 1️⃣ Load data
dat <- read_sheet("https://docs.google.com/spreadsheets/d/1KcAYb0czCxgbFpE-7DaJSv4EGLgqm6xgdZbpPmvlkNc/edit?usp=sharing")
# 2️⃣ Parse Date safely
dat <- dat %>%
mutate(Date = parse_date_time(Date, orders = c("mdy", "dmy", "ymd"))) %>%
filter(!is.na(Date))
# 3️⃣ Parse Sample into Bact, Temp, Salinity, and Rep
morph <- dat %>%
separate(Sample, into = c("Bact", "Temp", "Salinity", "Extra", "Rep"), sep = "_", remove = FALSE, fill = "right") %>%
mutate(
Rep = ifelse(is.na(Rep), Extra, Rep),  # If 4 parts (like OTB_H_30_1), Rep is in "Extra"
Rep = as.character(Rep)
) %>%
select(-Extra)  # Drop if you don't need the extra column
# 4️⃣ Pivot longer and calculate relative abundance
rel_abund_by_rep <- morph %>%
pivot_longer(
cols = -c(Bact, Temp, Rep, Salinity, Date, Sample),  # pivot only numeric columns
names_to = "category",
values_to = "val"
) %>%
filter(category != "total_images") %>%
group_by(Bact, Temp, Rep, Salinity, Date) %>%
mutate(
sumcount = sum(val, na.rm = TRUE),
percent  = val / sumcount
) %>%
ungroup()
# 5️⃣ Check for presence of "Cyst" category
if("cyst" %in% rel_abund_by_rep$category){
# Filter for Cyst and remove NAs
cyst_data <- rel_abund_by_rep %>%
filter(category == "cyst") %>%
filter(!is.na(percent))
if(nrow(cyst_data) > 0){
# Plot
ggplot(cyst_data, aes(x = Date, y = percent, color = Bact)) +
geom_point() +
facet_grid(Salinity ~ Temp) +
theme_bw() +
theme(
panel.grid.major.x = element_blank(),
panel.grid.minor.y = element_blank()
) +
scale_color_manual(
values = c("LD" = "#00CED1", "OTB" = "#CD7F32")
) +
ggtitle("Relative Abundance of Cysts by Replicate") +
ylab("Percent of total counts")
} else {
message("No rows with valid 'Cyst' data to plot.")
}
} else {
message("No 'Cyst' category present in the dataset!")
}
ggsave("%cyst.jpg", width = 7, height = 6)
library(googlesheets4)
library(dplyr)
library(tidyr)
library(lubridate)
library(ggplot2)
library(stringr)
# 1️⃣ Load data
dat <- read_sheet("https://docs.google.com/spreadsheets/d/1KcAYb0czCxgbFpE-7DaJSv4EGLgqm6xgdZbpPmvlkNc/edit?usp=sharing")
# 2️⃣ Parse Date safely
dat <- dat %>%
mutate(Date = parse_date_time(Date, orders = c("mdy", "dmy", "ymd"))) %>%
filter(!is.na(Date))
# 3️⃣ Parse Sample into Bact, Temp, Salinity, and Rep
morph <- dat %>%
separate(Sample, into = c("Bact", "Temp", "Salinity", "Extra", "Rep"), sep = "_", remove = FALSE, fill = "right") %>%
mutate(
Rep = ifelse(is.na(Rep), Extra, Rep),  # If 4 parts (like OTB_H_30_1), Rep is in "Extra"
Rep = as.character(Rep)
) %>%
select(-Extra)  # Drop if you don't need the extra column
# 4️⃣ Pivot longer and calculate relative abundance
rel_abund_by_rep <- morph %>%
pivot_longer(
cols = -c(Bact, Temp, Rep, Salinity, Date, Sample),  # pivot only numeric columns
names_to = "category",
values_to = "val"
) %>%
filter(category != "total_images") %>%
group_by(Bact, Temp, Rep, Salinity, Date) %>%
mutate(
sumcount = sum(val, na.rm = TRUE),
percent  = val / sumcount
) %>%
ungroup()
# 5️⃣ Check for presence of "Cyst" category
if("cyst" %in% rel_abund_by_rep$category){
# Filter for Cyst and remove NAs
cyst_data <- rel_abund_by_rep %>%
filter(category == "cyst") %>%
filter(!is.na(percent))
if(nrow(cyst_data) > 0){
# Plot
ggplot(cyst_data, aes(x = Date, y = percent, color = Bact)) +
geom_point() +
facet_grid(Salinity ~ Temp) +
theme_bw() +
theme(
panel.grid.major.x = element_blank(),
panel.grid.minor.y = element_blank()
) +
scale_color_manual(
values = c("LD" = "#00CED1", "OTB" = "#CD7F32")
) +
ggtitle("Relative Abundance of Cysts by Replicate") +
ylab("Percent of total counts")
} else {
message("No rows with valid 'Cyst' data to plot.")
}
} else {
message("No 'Cyst' category present in the dataset!")
}
ggsave("percent_cyst.jpg", width = 7, height = 6)
knitr::opts_chunk$set(echo = TRUE)
ammonium_trial<-read_sheet("https://docs.google.com/spreadsheets/d/1QRzU9teNRcPwRhmw8oUkU11Vfzaa26bnVQpcDRTGL2E/edit?usp=sharing")
knitr::opts_chunk$set(echo = TRUE)
library(tidyr)
library(dplyr)
library(ggplot2)
library(lubridate)
library(stringr)
library(purrr)
"%ni%" <- Negate("%in%")
library(googlesheets4)
library(patchwork)
library(growthrates)
ammonium_trial<-read_sheet("https://docs.google.com/spreadsheets/d/1QRzU9teNRcPwRhmw8oUkU11Vfzaa26bnVQpcDRTGL2E/edit?usp=sharing")
ammonium_trial$Date <- ymd(ammonium_trial$Date)
ammonium_trial$Rep <- as.character(ammonium_trial$Rep)
ammonium_trial$RFU <- as.numeric(ammonium_trial$RFU)
data(ammonium_trial)
str(ammonium_trial)
head(ammonium_trial)
"%ni%" <- Negate("%in%")
amm <- ammonium_trial %>% filter(Round %in% c(1, 3, 4, 5)) %>% separate(Culture, into = c("bact"), sep = "_", remove = FALSE ) %>%
separate(bact, into = c("x", "y", "z", "bact1"), sep = " ", remove = FALSE) %>% mutate(bact1 = case_when(bact %in% c("LL", "OTB") ~ bact, bact %ni% c("LL", "OTB") ~ bact1))
amm %>% ggplot(aes(x=Day, y = RFU, color = bact1)) + geom_point(alpha = 0.8) + theme_test() + facet_grid(~Round) + scale_color_manual(values = c("cornflowerblue", "gold" ))+ geom_smooth(se = FALSE) #+ scale_y_log10()
ggsave("ammoniumtrialclean_1022.jpg", width = 10, height = 8)
library(tidyr)
library(dplyr)
library(ggplot2)
library(lubridate)
library(stringr)
library(purrr)
"%ni%" <- Negate("%in%")
library(googlesheets4)
library(patchwork)
hottrial<- read_sheet("https://docs.google.com/spreadsheets/d/18_2ZNyk1GvUCoxckpurD9vz5-bD_RSRSeCNKY0YZf04/edit?usp=sharing")
hottrial$Date <- ymd(hottrial$Date)
hottrial$Rep <- as.character(hottrial$Rep)
hottrial$RFU <- as.numeric(hottrial$RFU)
hottrial %>%
filter(Round %in% c(2, 3, 4)) %>%
mutate(Round_label = case_when(
Round == 2 ~ "Round 1 in 30°C",
Round == 3 ~ "S.T. 1",
Round == 4 ~ "S.T. 2",
)) %>%
ggplot(aes(x = Date, y = RFU, color = Culture)) +
geom_point() +
theme_test() +
ggtitle("Pyrodinium growth in 30°C") +
facet_grid(~ Round_label, scales = "free_x")
ggsave("hotonestrial_1022.jpg", width = 7, height = 6)
knitr::opts_chunk$set(echo = TRUE)
library(tidyr)
library(dplyr)
library(ggplot2)
library(lubridate)
library(stringr)
library(purrr)
"%ni%" <- Negate("%in%")
library(googlesheets4)
library(patchwork)
library(growthrates)
ammonium_trial<-read_sheet("https://docs.google.com/spreadsheets/d/1QRzU9teNRcPwRhmw8oUkU11Vfzaa26bnVQpcDRTGL2E/edit?usp=sharing")
ammonium_trial$Date <- ymd(ammonium_trial$Date)
ammonium_trial$Rep <- as.character(ammonium_trial$Rep)
ammonium_trial$RFU <- as.numeric(ammonium_trial$RFU)
data(ammonium_trial)
str(ammonium_trial)
head(ammonium_trial)
"%ni%" <- Negate("%in%")
amm <- ammonium_trial %>% filter(Round %in% c(1, 3, 4, 5)) %>% separate(Culture, into = c("bact"), sep = "_", remove = FALSE ) %>%
separate(bact, into = c("x", "y", "z", "bact1"), sep = " ", remove = FALSE) %>% mutate(bact1 = case_when(bact %in% c("LL", "OTB") ~ bact, bact %ni% c("LL", "OTB") ~ bact1))
amm %>% ggplot(aes(x=Day, y = RFU, color = bact1)) + geom_point(alpha = 0.8) + theme_test() + facet_grid(~Round) + scale_color_manual(values = c("cornflowerblue", "gold" ))+ geom_smooth(se = FALSE) #+ scale_y_log10()
ggsave("ammoniumtrialclean_1024.jpg", width = 10, height = 8)
library(tidyr)
library(dplyr)
library(ggplot2)
library(lubridate)
library(stringr)
library(purrr)
"%ni%" <- Negate("%in%")
library(googlesheets4)
library(patchwork)
hottrial<- read_sheet("https://docs.google.com/spreadsheets/d/18_2ZNyk1GvUCoxckpurD9vz5-bD_RSRSeCNKY0YZf04/edit?usp=sharing")
library(tidyr)
library(dplyr)
library(ggplot2)
library(lubridate)
library(stringr)
library(purrr)
"%ni%" <- Negate("%in%")
library(googlesheets4)
library(patchwork)
hottrial<- read_sheet("https://docs.google.com/spreadsheets/d/18_2ZNyk1GvUCoxckpurD9vz5-bD_RSRSeCNKY0YZf04/edit?usp=sharing")
hottrial$Date <- ymd(hottrial$Date)
hottrial$Rep <- as.character(hottrial$Rep)
hottrial$RFU <- as.numeric(hottrial$RFU)
hottrial %>%
filter(Round %in% c(2, 3, 4)) %>%
mutate(Round_label = case_when(
Round == 2 ~ "Round 1 in 30°C",
Round == 3 ~ "S.T. 1",
Round == 4 ~ "S.T. 2",
)) %>%
ggplot(aes(x = Date, y = RFU, color = Culture)) +
geom_point() +
theme_test() +
ggtitle("Pyrodinium growth in 30°C") +
facet_grid(~ Round_label, scales = "free_x")
hottrial %>%
filter(Round %in% c(2, 3, 4)) %>%
mutate(Round_label = case_when(
Round == 2 ~ "Round 1 in 30°C",
Round == 3 ~ "S.T. 1",
Round == 4 ~ "S.T. 2",
)) %>%
ggplot(aes(x = Day, y = RFU, color = Culture)) +
geom_point() +
theme_test() +
ggtitle("Pyrodinium growth in 30°C") +
facet_grid(~ Round_label, scales = "free_x")
ggsave("hotonestrial_1024.jpg", width = 7, height = 6)
