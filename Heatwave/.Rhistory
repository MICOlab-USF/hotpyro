rel_abund_by_rep <- morph %>%
pivot_longer(
cols = -c(Bact, Temp, Rep, Salinity, Date, Sample),  # pivot only numeric columns
names_to = "category",
values_to = "val"
) %>%
filter(category != "total_images") %>%
group_by(Bact, Temp, Rep, Salinity, Date) %>%
mutate(
sumcount = sum(val, na.rm = TRUE),
percent  = val / sumcount
) %>%
ungroup()
# 5️⃣ Check for presence of "Cyst" category
if("cyst" %in% rel_abund_by_rep$category){
# Filter for Cyst and remove NAs
cyst_data <- rel_abund_by_rep %>%
filter(category == "cyst") %>%
filter(!is.na(percent))
if(nrow(cyst_data) > 0){
# Plot
ggplot(cyst_data, aes(x = Date, y = percent, color = Bact)) +
geom_point() +
facet_grid(Salinity ~ Temp) +
theme_bw() +
theme(
panel.grid.major.x = element_blank(),
panel.grid.minor.y = element_blank()
) +
ggtitle("Relative Abundance of Cysts by Replicate") +
ylab("Percent of total counts")
} else {
message("No rows with valid 'Cyst' data to plot.")
}
} else {
message("No 'Cyst' category present in the dataset!")
}
library(googlesheets4)
library(dplyr)
library(tidyr)
library(lubridate)
library(ggplot2)
library(stringr)
# 1️⃣ Load data
dat <- read_sheet("https://docs.google.com/spreadsheets/d/1KcAYb0czCxgbFpE-7DaJSv4EGLgqm6xgdZbpPmvlkNc/edit?usp=sharing")
# 2️⃣ Parse Date safely
dat <- dat %>%
mutate(Date = parse_date_time(Date, orders = c("mdy", "dmy", "ymd"))) %>%
filter(!is.na(Date))
# 3️⃣ Separate Sample
morph <- dat %>%
separate(Sample, into = c("Bact", "Temp", "Salinity"), sep = "_", remove = FALSE) %>%
mutate(
Rep  = str_sub(Bact, start = -1),
Bact = str_sub(Bact, end = -2)
)
# 4️⃣ Pivot longer and calculate relative abundance
rel_abund_by_rep <- morph %>%
pivot_longer(
cols = -c(Bact, Temp, Rep, Salinity, Date, Sample),  # pivot only numeric columns
names_to = "category",
values_to = "val"
) %>%
filter(category != "total_images") %>%
group_by(Bact, Temp, Rep, Salinity, Date) %>%
mutate(
sumcount = sum(val, na.rm = TRUE),
percent  = val / sumcount
) %>%
ungroup()
# 5️⃣ Check for presence of "Cyst" category
if("cyst" %in% rel_abund_by_rep$category){
# Filter for Cyst and remove NAs
cyst_data <- rel_abund_by_rep %>%
filter(category == "cyst") %>%
filter(!is.na(percent))
if(nrow(cyst_data) > 0){
# Plot
ggplot(cyst_data, aes(x = Date, y = percent, color = Bact)) +
geom_point() +
facet_grid(Salinity ~ Temp) +
theme_bw() +
theme(
panel.grid.major.x = element_blank(),
panel.grid.minor.y = element_blank()
) +
ggtitle("Relative Abundance of Cysts by Replicate") +
ylab("Percent of total counts")
} else {
message("No rows with valid 'Cyst' data to plot.")
}
} else {
message("No 'Cyst' category present in the dataset!")
}
library(googlesheets4)
library(dplyr)
library(tidyr)
library(lubridate)
library(ggplot2)
library(stringr)
# 1️⃣ Load data
dat <- read_sheet("https://docs.google.com/spreadsheets/d/1KcAYb0czCxgbFpE-7DaJSv4EGLgqm6xgdZbpPmvlkNc/edit?usp=sharing")
# 2️⃣ Parse Date safely
dat <- dat %>%
mutate(Date = parse_date_time(Date, orders = c("mdy", "dmy", "ymd"))) %>%
filter(!is.na(Date))
# 3️⃣ Parse Sample into Bact, Temp, Salinity, and Rep
morph <- dat %>%
separate(Sample, into = c("Bact", "Temp", "Salinity", "Extra", "Rep"), sep = "_", remove = FALSE, fill = "right") %>%
mutate(
Rep = ifelse(is.na(Rep), Extra, Rep),  # If 4 parts (like OTB_H_30_1), Rep is in "Extra"
Rep = as.character(Rep)
) %>%
select(-Extra)  # Drop if you don't need the extra column
# 4️⃣ Pivot longer and calculate relative abundance
rel_abund_by_rep <- morph %>%
pivot_longer(
cols = -c(Bact, Temp, Rep, Salinity, Date, Sample),  # pivot only numeric columns
names_to = "category",
values_to = "val"
) %>%
filter(category != "total_images") %>%
group_by(Bact, Temp, Rep, Salinity, Date) %>%
mutate(
sumcount = sum(val, na.rm = TRUE),
percent  = val / sumcount
) %>%
ungroup()
# 5️⃣ Check for presence of "Cyst" category
if("cyst" %in% rel_abund_by_rep$category){
# Filter for Cyst and remove NAs
cyst_data <- rel_abund_by_rep %>%
filter(category == "cyst") %>%
filter(!is.na(percent))
if(nrow(cyst_data) > 0){
# Plot
ggplot(cyst_data, aes(x = Date, y = percent, color = Bact)) +
geom_point() +
facet_grid(Salinity ~ Temp) +
theme_bw() +
theme(
panel.grid.major.x = element_blank(),
panel.grid.minor.y = element_blank()
) +
ggtitle("Relative Abundance of Cysts by Replicate") +
ylab("Percent of total counts")
} else {
message("No rows with valid 'Cyst' data to plot.")
}
} else {
message("No 'Cyst' category present in the dataset!")
}
library(googlesheets4)
library(dplyr)
library(tidyr)
library(lubridate)
library(ggplot2)
library(stringr)
# 1️⃣ Load data
dat <- read_sheet("https://docs.google.com/spreadsheets/d/1KcAYb0czCxgbFpE-7DaJSv4EGLgqm6xgdZbpPmvlkNc/edit?usp=sharing")
# 2️⃣ Parse Date safely
dat <- dat %>%
mutate(Date = parse_date_time(Date, orders = c("mdy", "dmy", "ymd"))) %>%
filter(!is.na(Date))
# 3️⃣ Parse Sample into Bact, Temp, Salinity, and Rep
morph <- dat %>%
separate(Sample, into = c("Bact", "Temp", "Salinity", "Extra", "Rep"), sep = "_", remove = FALSE, fill = "right") %>%
mutate(
Rep = ifelse(is.na(Rep), Extra, Rep),  # If 4 parts (like OTB_H_30_1), Rep is in "Extra"
Rep = as.character(Rep)
) %>%
select(-Extra)  # Drop if you don't need the extra column
# 4️⃣ Pivot longer and calculate relative abundance
rel_abund_by_rep <- morph %>%
pivot_longer(
cols = -c(Bact, Temp, Rep, Salinity, Date, Sample),  # pivot only numeric columns
names_to = "category",
values_to = "val"
) %>%
filter(category != "total_images") %>%
group_by(Bact, Temp, Rep, Salinity, Date) %>%
mutate(
sumcount = sum(val, na.rm = TRUE),
percent  = val / sumcount
) %>%
ungroup()
# 5️⃣ Check for presence of "Cyst" category
if("cyst" %in% rel_abund_by_rep$category){
# Filter for Cyst and remove NAs
cyst_data <- rel_abund_by_rep %>%
filter(category == "cyst") %>%
filter(!is.na(percent))
if(nrow(cyst_data) > 0){
# Plot
ggplot(cyst_data, aes(x = Date, y = percent, color = Bact)) +
geom_point() +
facet_grid(Salinity ~ Temp) +
scale_color_manual(values = c("LD" = "gold", "OTB" = "purple")) +
theme_bw() +
theme(
panel.grid.major.x = element_blank(),
panel.grid.minor.y = element_blank()
) +
ggtitle("Relative Abundance of Cysts by Replicate") +
ylab("Percent of total counts")
library(googlesheets4)
library(dplyr)
library(tidyr)
library(lubridate)
library(ggplot2)
library(stringr)
# 1️⃣ Load data
dat <- read_sheet("https://docs.google.com/spreadsheets/d/1KcAYb0czCxgbFpE-7DaJSv4EGLgqm6xgdZbpPmvlkNc/edit?usp=sharing")
# 2️⃣ Parse Date safely
dat <- dat %>%
mutate(Date = parse_date_time(Date, orders = c("mdy", "dmy", "ymd"))) %>%
filter(!is.na(Date))
# 3️⃣ Parse Sample into Bact, Temp, Salinity, and Rep
morph <- dat %>%
separate(Sample, into = c("Bact", "Temp", "Salinity", "Extra", "Rep"), sep = "_", remove = FALSE, fill = "right") %>%
mutate(
Rep = ifelse(is.na(Rep), Extra, Rep),  # If 4 parts (like OTB_H_30_1), Rep is in "Extra"
Rep = as.character(Rep)
) %>%
select(-Extra)  # Drop if you don't need the extra column
# 4️⃣ Pivot longer and calculate relative abundance
rel_abund_by_rep <- morph %>%
pivot_longer(
cols = -c(Bact, Temp, Rep, Salinity, Date, Sample),  # pivot only numeric columns
names_to = "category",
values_to = "val"
) %>%
filter(category != "total_images") %>%
group_by(Bact, Temp, Rep, Salinity, Date) %>%
mutate(
sumcount = sum(val, na.rm = TRUE),
percent  = val / sumcount
) %>%
ungroup()
# 5️⃣ Check for presence of "Cyst" category
if("cyst" %in% rel_abund_by_rep$category){
# Filter for Cyst and remove NAs
cyst_data <- rel_abund_by_rep %>%
filter(category == "cyst") %>%
filter(!is.na(percent))
if(nrow(cyst_data) > 0){
# Plot
ggplot(cyst_data, aes(x = Date, y = percent, color = Bact)) +
geom_point() +
facet_grid(Salinity ~ Temp) +
theme_bw() +
theme(
panel.grid.major.x = element_blank(),
panel.grid.minor.y = element_blank()
) +
scale_color_manual(
values = c("LD" = "gold", "OTB" = "purple")
) +
ggtitle("Relative Abundance of Cysts by Replicate") +
ylab("Percent of total counts")
} else {
message("No rows with valid 'Cyst' data to plot.")
}
} else {
message("No 'Cyst' category present in the dataset!")
}
library(googlesheets4)
library(dplyr)
library(tidyr)
library(lubridate)
library(ggplot2)
library(stringr)
# 1️⃣ Load data
dat <- read_sheet("https://docs.google.com/spreadsheets/d/1KcAYb0czCxgbFpE-7DaJSv4EGLgqm6xgdZbpPmvlkNc/edit?usp=sharing")
# 2️⃣ Parse Date safely
dat <- dat %>%
mutate(Date = parse_date_time(Date, orders = c("mdy", "dmy", "ymd"))) %>%
filter(!is.na(Date))
# 3️⃣ Parse Sample into Bact, Temp, Salinity, and Rep
morph <- dat %>%
separate(Sample, into = c("Bact", "Temp", "Salinity", "Extra", "Rep"), sep = "_", remove = FALSE, fill = "right") %>%
mutate(
Rep = ifelse(is.na(Rep), Extra, Rep),  # If 4 parts (like OTB_H_30_1), Rep is in "Extra"
Rep = as.character(Rep)
) %>%
select(-Extra)  # Drop if you don't need the extra column
# 4️⃣ Pivot longer and calculate relative abundance
rel_abund_by_rep <- morph %>%
pivot_longer(
cols = -c(Bact, Temp, Rep, Salinity, Date, Sample),  # pivot only numeric columns
names_to = "category",
values_to = "val"
) %>%
filter(category != "total_images") %>%
group_by(Bact, Temp, Rep, Salinity, Date) %>%
mutate(
sumcount = sum(val, na.rm = TRUE),
percent  = val / sumcount
) %>%
ungroup()
# 5️⃣ Check for presence of "Cyst" category
if("cyst" %in% rel_abund_by_rep$category){
# Filter for Cyst and remove NAs
cyst_data <- rel_abund_by_rep %>%
filter(category == "cyst") %>%
filter(!is.na(percent))
if(nrow(cyst_data) > 0){
# Plot
ggplot(cyst_data, aes(x = Date, y = percent, color = Bact)) +
geom_point() +
facet_grid(Salinity ~ Temp) +
theme_bw() +
theme(
panel.grid.major.x = element_blank(),
panel.grid.minor.y = element_blank()
) +
scale_color_manual(
values = c("LD" = "green", "OTB" = "blue")
) +
ggtitle("Relative Abundance of Cysts by Replicate") +
ylab("Percent of total counts")
} else {
message("No rows with valid 'Cyst' data to plot.")
}
} else {
message("No 'Cyst' category present in the dataset!")
}
library(googlesheets4)
library(dplyr)
library(tidyr)
library(lubridate)
library(ggplot2)
library(stringr)
# 1️⃣ Load data
dat <- read_sheet("https://docs.google.com/spreadsheets/d/1KcAYb0czCxgbFpE-7DaJSv4EGLgqm6xgdZbpPmvlkNc/edit?usp=sharing")
# 2️⃣ Parse Date safely
dat <- dat %>%
mutate(Date = parse_date_time(Date, orders = c("mdy", "dmy", "ymd"))) %>%
filter(!is.na(Date))
# 3️⃣ Parse Sample into Bact, Temp, Salinity, and Rep
morph <- dat %>%
separate(Sample, into = c("Bact", "Temp", "Salinity", "Extra", "Rep"), sep = "_", remove = FALSE, fill = "right") %>%
mutate(
Rep = ifelse(is.na(Rep), Extra, Rep),  # If 4 parts (like OTB_H_30_1), Rep is in "Extra"
Rep = as.character(Rep)
) %>%
select(-Extra)  # Drop if you don't need the extra column
# 4️⃣ Pivot longer and calculate relative abundance
rel_abund_by_rep <- morph %>%
pivot_longer(
cols = -c(Bact, Temp, Rep, Salinity, Date, Sample),  # pivot only numeric columns
names_to = "category",
values_to = "val"
) %>%
filter(category != "total_images") %>%
group_by(Bact, Temp, Rep, Salinity, Date) %>%
mutate(
sumcount = sum(val, na.rm = TRUE),
percent  = val / sumcount
) %>%
ungroup()
# 5️⃣ Check for presence of "Cyst" category
if("cyst" %in% rel_abund_by_rep$category){
# Filter for Cyst and remove NAs
cyst_data <- rel_abund_by_rep %>%
filter(category == "cyst") %>%
filter(!is.na(percent))
if(nrow(cyst_data) > 0){
# Plot
ggplot(cyst_data, aes(x = Date, y = percent, color = Bact)) +
geom_point() +
facet_grid(Salinity ~ Temp) +
theme_bw() +
theme(
panel.grid.major.x = element_blank(),
panel.grid.minor.y = element_blank()
) +
scale_color_manual(
values = c("LD" = "#008080", "OTB" = "#CD7F32")
) +
ggtitle("Relative Abundance of Cysts by Replicate") +
ylab("Percent of total counts")
} else {
message("No rows with valid 'Cyst' data to plot.")
}
} else {
message("No 'Cyst' category present in the dataset!")
}
library(googlesheets4)
library(dplyr)
library(tidyr)
library(lubridate)
library(ggplot2)
library(stringr)
# 1️⃣ Load data
dat <- read_sheet("https://docs.google.com/spreadsheets/d/1KcAYb0czCxgbFpE-7DaJSv4EGLgqm6xgdZbpPmvlkNc/edit?usp=sharing")
# 2️⃣ Parse Date safely
dat <- dat %>%
mutate(Date = parse_date_time(Date, orders = c("mdy", "dmy", "ymd"))) %>%
filter(!is.na(Date))
# 3️⃣ Parse Sample into Bact, Temp, Salinity, and Rep
morph <- dat %>%
separate(Sample, into = c("Bact", "Temp", "Salinity", "Extra", "Rep"), sep = "_", remove = FALSE, fill = "right") %>%
mutate(
Rep = ifelse(is.na(Rep), Extra, Rep),  # If 4 parts (like OTB_H_30_1), Rep is in "Extra"
Rep = as.character(Rep)
) %>%
select(-Extra)  # Drop if you don't need the extra column
# 4️⃣ Pivot longer and calculate relative abundance
rel_abund_by_rep <- morph %>%
pivot_longer(
cols = -c(Bact, Temp, Rep, Salinity, Date, Sample),  # pivot only numeric columns
names_to = "category",
values_to = "val"
) %>%
filter(category != "total_images") %>%
group_by(Bact, Temp, Rep, Salinity, Date) %>%
mutate(
sumcount = sum(val, na.rm = TRUE),
percent  = val / sumcount
) %>%
ungroup()
# 5️⃣ Check for presence of "Cyst" category
if("cyst" %in% rel_abund_by_rep$category){
# Filter for Cyst and remove NAs
cyst_data <- rel_abund_by_rep %>%
filter(category == "cyst") %>%
filter(!is.na(percent))
if(nrow(cyst_data) > 0){
# Plot
ggplot(cyst_data, aes(x = Date, y = percent, color = Bact)) +
geom_point() +
facet_grid(Salinity ~ Temp) +
theme_bw() +
theme(
panel.grid.major.x = element_blank(),
panel.grid.minor.y = element_blank()
) +
scale_color_manual(
values = c("LD" = "#00CED1", "OTB" = "#CD7F32")
) +
ggtitle("Relative Abundance of Cysts by Replicate") +
ylab("Percent of total counts")
} else {
message("No rows with valid 'Cyst' data to plot.")
}
} else {
message("No 'Cyst' category present in the dataset!")
}
ggsave("%cyst.jpg", width = 7, height = 6)
library(googlesheets4)
library(dplyr)
library(tidyr)
library(lubridate)
library(ggplot2)
library(stringr)
# 1️⃣ Load data
dat <- read_sheet("https://docs.google.com/spreadsheets/d/1KcAYb0czCxgbFpE-7DaJSv4EGLgqm6xgdZbpPmvlkNc/edit?usp=sharing")
# 2️⃣ Parse Date safely
dat <- dat %>%
mutate(Date = parse_date_time(Date, orders = c("mdy", "dmy", "ymd"))) %>%
filter(!is.na(Date))
# 3️⃣ Parse Sample into Bact, Temp, Salinity, and Rep
morph <- dat %>%
separate(Sample, into = c("Bact", "Temp", "Salinity", "Extra", "Rep"), sep = "_", remove = FALSE, fill = "right") %>%
mutate(
Rep = ifelse(is.na(Rep), Extra, Rep),  # If 4 parts (like OTB_H_30_1), Rep is in "Extra"
Rep = as.character(Rep)
) %>%
select(-Extra)  # Drop if you don't need the extra column
# 4️⃣ Pivot longer and calculate relative abundance
rel_abund_by_rep <- morph %>%
pivot_longer(
cols = -c(Bact, Temp, Rep, Salinity, Date, Sample),  # pivot only numeric columns
names_to = "category",
values_to = "val"
) %>%
filter(category != "total_images") %>%
group_by(Bact, Temp, Rep, Salinity, Date) %>%
mutate(
sumcount = sum(val, na.rm = TRUE),
percent  = val / sumcount
) %>%
ungroup()
# 5️⃣ Check for presence of "Cyst" category
if("cyst" %in% rel_abund_by_rep$category){
# Filter for Cyst and remove NAs
cyst_data <- rel_abund_by_rep %>%
filter(category == "cyst") %>%
filter(!is.na(percent))
if(nrow(cyst_data) > 0){
# Plot
ggplot(cyst_data, aes(x = Date, y = percent, color = Bact)) +
geom_point() +
facet_grid(Salinity ~ Temp) +
theme_bw() +
theme(
panel.grid.major.x = element_blank(),
panel.grid.minor.y = element_blank()
) +
scale_color_manual(
values = c("LD" = "#00CED1", "OTB" = "#CD7F32")
) +
ggtitle("Relative Abundance of Cysts by Replicate") +
ylab("Percent of total counts")
} else {
message("No rows with valid 'Cyst' data to plot.")
}
} else {
message("No 'Cyst' category present in the dataset!")
}
ggsave("percent_cyst.jpg", width = 7, height = 6)
